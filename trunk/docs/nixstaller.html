<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <title>Nixstaller 0.1 documentation</title>
</head>

<h1><strong>Nixstaller documentation</strong></h1>
<hr>

<br><br>

<p> <h2>Table of contents</h2>
 <ul>
   <li> <A href="#intro" name="toc-intro">Introduction</A> </li>
   <li> <A href="#qstart" name="toc-qstart">Quick start</A> </li>
   <li> <A href="#basics" name="toc-first">Basics</A> </li>
   <li> <A href="#config" name="toc-config">Configuration files</A> </li>
   <li> <A href="create" name="toc-create">Creating an install package</A> </li>
   <li> <A href="#compile" name="toc-compile">Compiling nixstaller</A> </li>
   <li> <A href="#faq" name="toc-faq">Frequently Asked Questions (FAQ)</A> </li>
 </ul>

<br>

<p> <h2><A href="#toc-intro" name="intro">Introduction</A></h2>
This document describes how to use nixstaller to create installers for unix like systems. <br>
If you can't wait you can read the <A href="#qstart">Quick start section</A>. <br>
<br>
<h3>Features</h3>
Here is a list with the main features. Read further for more info to see what they do and how to use them.<br>

<ul>
   <li>2 different frontends used for the installer: <A href="http://www.fltk.org">FLTK</A> and <A href="http://www.gnu.org/software/ncurses/ncurses.html">ncurses</A> using <A href="http://invisible-island.net/cdk/">CDK</A> </li>
   <li>Support for the following OS'es: Linux, FreeBSD and NetBSD.</li>
   <li>An installer itself has the following features:
   <ul>
      <li>Can be translated(no UTF yet). Dutch and english translations are supplied by default</li>
      <li>Screen where the user can choose the language</li>
      <li>Optional intro screen with customizable image and text</li>
      <li>Optional screen where a user have to accept a license agreement</li>
      <li>Optional screen where the user has to select a destination directory</li>
      <li>Optional screen where the user can set parameters used by installation commands</li>
      <li>Installation progress screen</li>
      <li>Optional screen which appears when the installation is done</li>
   </ul>
   </li>
   <li>Commands which can be executed after file extraction. The parameters used by these commands can be customized by the end user during installation.</li>
   <li>Files that come with the installer can be either extracted to a temporary directory, a given directory or a directory specified by the user.</li>
   <li>Installation files can be compressed with either gzip or bzip2</li>
   <li>Frontends are almost completly staticly linked. This way the end user doesn't have to worry about missing dependencies for the installer itself.</li>
 </ul>

<p> <h2><A href="#toc-qstart" name="qstart">Quick start</A></h2>
Meh...just read the tutorial :)<br>

<p> <h2><A href="#toc-first" name="basics">Basics</A></h2>
In this section the main things will be explained so you can get a idea how to use nixstaller and what it can do.<br>

<p> <h3>Installation package</h3>
The goal of nixstaller is to create a installation package. This package contains the following things:<br>
<ul>
   <li>One or more frontends for the installer.</li>
   <li>A config file which tells what the installer should do.</li>
   <li>Language files for translations.</li>
   <li>Some (optional) text files containing the welcome message, the license agreement and a message after the installation is finished.</li>
   <li>An archive containing the actual files that the installer should use for installation(eg your program and its required files).</li>
   <li>Optional: an archive containing OS specific files that should be used for installation.</li>
   <li>A few required libs which couldn't be linked staticly.</li>
 </ul>
<br>
From these files will be a self extracting archive made(with the help of <A href="http://www.megastep.org/makeself/">makeself</A>). <br>
The creation of a package is discussed in section <A href="#create">Creating an install package</A>.

<p> <h3>Frontends</h3>
Currently there are 2 frontends used for the installer: The first is using <A href="http://www.fltk.org">FLTK</A> and the second uses <A href="http://www.gnu.org/software/ncurses/ncurses.html">ncurses</A> with <A href="http://invisible-island.net/cdk/">CDK</A>.
If the the installer starts it will check if the user is running X. If it is so it will launch the FLTK frontend, otherwise the ncurses frontend will be launched.<br>
You can specifiy manually which frontends will be included in the installer package.

<p> <h3>Config file</h3>
To configure the installer you need to make/edit a simple config file. There are several examples in the example/ directory.<br>
Please read the <A href="#config">Configuration files section</A> to know what to put in that file.

<p> <h3>Language files</h3>
In order to translate the text used by the installer you must use a translation file. This file is simply called 'strings' and will contain all (english) strings used by the installer with the translation beneath it.
Language files are stored in a subdirectory in the lang/ directory. The subdirectory should be the name of the language itself.<br>
Currently there are already 2 translations: dutch and english. You can 'translate' the english 'strings' file in order to modify texts used by the installer.<br>

<br>
Here is a example taken from the file 'lang/dutch/strings': <br>

<br>
<samp>License Agreement <br>
Licentie overeenkomst <br></samp>
<br>

"Licentie overeenkomst" is dutch for "License Agreement". Its very important that the english text(the first line) is exactly the same as used by the installer.<br>
If you read further in this file you will see the following sentence:<br>

<br>
<samp>Installation of %s complete!<br>
Installatie van %s gereed!<br></samp>
<br>

Notice the '%s'? The '%s' will be replaced by the installer with another string. This can be all kind of things, in this case it is the program name.<br>
<br>
<strong>IMPORTANT:</strong> Currently there is no UTF support yet. This means that you can't use any 'special' characters yet.<br>
<br>

<strong>Other things that can be translated</strong><br>
There are other things to be translated aswell:
<ul>
   <li> The welcome message </li>
   <li> The license agreement </li>
   <li> The 'finish message' </li>
   <li> Descriptions for commandentries and parameter entries </li>
   <li> Choices defined with 'addchoice' </li>
 </ul>
 <br>
The followinging sections will explain what they are and how to translate those.<br>

<p> <h3>Welcome message, license agreement and the 'finish message'</h3>
<strong>Welcome message</strong><br>
The welcome message is what will be displayed right after the user selected a language.<br>
<br>

<strong>License agreement</strong><br>
The user can agree to a license agreement after the welcome message.<br>
<br>

<strong>'Finish message'</strong><br>
This is the message that will be displayed after the installation has (succesfully) ended.<br>
<br>

All these items are stored in plain text files.<br>
The filenames for the welcome message, license agreement and finish message are respectively: 'welcome', 'license' and 'finish'.<br>
You can put translated versions in the language subdirectories in the lang/ directory(ie 'lang/dutch/welcome'). See the <A href="#create">Creating an install package section</A> for info where to put the normal, untranslated files.

<p> <h3>The installation</h3>
<strong>Destination directory</strong><br>
There are 3 ways where the files can are extracted to:
<ol>
   <li>Specifified: During installation the user can say where they want to have their files (default)</li>
   <li>Temporaray: This is especially usefull for files which have to be compiled. The files will be extracted to a temporary directory and after that some {install commands} are called(such as './configure &amp;&amp; make &amp;&amp; make install) to prepare the package further for installation. After the installation is finished the files will be removed.</li>
   <li>A given directory. The files will always be extracted to this directory.</li>
</ol>
<br>

<strong>Install commands</strong><br>
After all the files are extracted some (optional) shell commands can be called in this directory. A good example for this is to compile a package.<br>
<br><em>Root access</em> <br>
Some commands(ie 'make install') may require root privileges. There are 2 ways to specify this:<br>
<ol>
   <li>Always: This command requires it, no matter what.</li>
   <li>Dependent: It depends on something else. Currently this can only be a directory specified by a parameter for this or another command. A good example to use this is 'make install' which depends on the --prefix parameter for configure. If the prefix points to an directory where the user doesn't have write access, 'make install' will need root access.</li>
</ol>
<br>
If a command requests root access a dialog will pop up asking the user to give the root password. The command will then be executed with 'su'.<br>
<br>
<em>Parameters</em><br>
Some commands (ie 'configure') may need commandline parameters(such as --prefix). Parameters such as the '--prefix' one can be configured (ie --prefix=/usr/local). If you specify these parameters in the {config file} the user can do so during installation. A screen will pop up before the installation begins where the user can configure each parameter specified in the config file.<br>
Currently there are 4 ways to configure a parameter:
<ol>
   <li>One that can be simply enabled or disabled (if disabled the parameter won't be used when executing the install command).</li>
   <li>String: The user can simply specify a text.</li>
   <li>Choice list: A menu will pop up where the user can specify a value.</li>
   <li>Directory: The user can specify a directory.</li>
</ol>
Here is an example: Lets say the command is './configure' and you have set '--prefix=' as a configurable parameter with as type 'directory'. Now right before the installation begins the user changes the directory for the prefix to '/usr'. the configure command will now look like this:<br>
<br>
<samp>./configure --prefix=/usr</samp><br>
<br>

You can set a default for each parameter, so that the user doesn't have to bother with everything.<br>
<br>
For each parameter you can also give a (short) description. If you add this description to one or more {language files} it will be translated when its shown.<br>
<br>
More info at the {config section}.

<p> <h2><A href="#toc-config" name="config">Configuration files</A></h2>
The config file is used to specify what the installer should do and how the package must be created.<br>
Config files can be very simple and small for simple installations.<br>
<br>
<p> <h3>General section</h3>
In this section you can put the general options for the installer. For installers without any install commands this is the only section used in the configuration file.<br>
<br>

<strong>appname</strong><br>
Sets the name of the package that is going to be installed.<br>
<br>
<samp>Usage: appname nameofapphere</samp><br>
<br>
<samp>Example: appname test</samp><br>
<br>
<br>

<strong>archtype</strong><br>
Sets which archive type to use for packing the package that is going to be installed.<br>
<br>
<samp>Usage: archtype gzip|bzip2</samp><br>
<br>
<samp>Example: archtype bzip2</samp><br>
<br>
<samp>Default: gzip</samp><br>
<br>
<br>

<strong>installdir</strong><br>
Sets where the install package files should be extracted too (see {insdir section} ).<br>
<br>
<samp>Usage: installdir select|temp|default dirnamehere</samp><br>
select: Let the user specify the install directory.<br>
temp: Extract files to a temporary directory.<br>
default: Extract the files specified by 'dirnamehere'.<br>
<br>
<samp>Example: installdir default /usr/local</samp><br>
<br>
<samp>Default: select</samp><br>
<br>
<samp>Note: The user should have permission the installation directory.</samp><br>
<br>
<br>

<strong>languages</strong><br>
Specifies a list of used languages.<br>
<br>
<samp>Usage: languages lang1 lang2 lang3 ...</samp><br>
<br>
<samp>Example: languages english dutch</samp><br>
<br>
<samp>Default: english</samp><br>
<br>
<br>

<strong>intropic</strong><br>
Specifies a picture which should be displayed at the welcome screen.<br>
Valid types are: jpg, png, gif and bmp.<br>
<br>
<samp>Usage: intropic picnamehere</samp><br>
<br>
<samp>Example: intropic intro.jpg</samp><br>
<br>
<br>

<strong>commandentry</strong><br>
Start point of a {commandentry}.<br>
<br>
<samp>Usage:<br>
commandentry<br>
[<br>
...<br>
options for a commandentry here<br>
...<br>
]<br></samp><br>
<br>

<p> <h3>Commandentries</h3>
A command entry is a part where info can be specified for a single install command. A commandentry starts with simply 'commandentry' and a left square bracket('[') beaneath it. The commandentry ends with a right square bracket(']'). All the configuration options for a commandentry should be between the 2 square brackets.<br>
<br>

Here is a small example how a commandentry may look like:<br>

<pre><samp>commandentry
[
   description Compiling test
   command make
]
<br></samp></pre>
<br>
A command entry has the following configure options: <br>

<strong>command</strong><br>
This specifies the actual command. It will be directly passed to sh (or su incase it needs root access).<br>
<br>
<samp>Usage: command commandlinehere</samp><br>
<br>
<samp>Example: command ./configure</samp><br>
<br>
<samp>Note: You can also use the additional functionality from SH such as 'if' or 'for'. Just make sure that everything is at one single line.</samp><br>
<br>
<br>

<strong>description</strong><br>
Here you can specify a simple description of what this command does. You can put any translations of it in the {language files}<br>
<br>
<samp>Usage: description descriptionhere</samp><br>
<br>
<samp>Example: description Configuring test for your system</samp>
<br>
<br>

<strong>needroot</strong><br>
Specifies if or when this command needs to be executed as the root user.<br>
<br>
<samp>Usage: needroot true|false|dependson varname</samp><br>
true: command always needs to be executed as root user.<br>
false: command never needs to be executed as root user.<br>
dependson: it depends on the directory that is selected for the parameter with the {variabele name} 'varname'.<br>
<br>
<samp>Example: needroot true</samp><br>
<br>
<samp>Default: false</samp><br>
<br>
<br>

<strong>exitonfailure</strong> <br>
If enabled, the installation will abort if the command fails to execute.<br>
<br>
<samp>Usage: exitonfailure true|false</samp><br>
<br>
<samp>Example: exitonfailure true</samp><br>
<br>
<samp>Default: true</samp><br>
<br>
<br>

<strong>path</strong><br>
Sets the $PATH environment variabele for this command.<br>
<br>
<samp>Usage: path dir1:dir2:dir3:...</samp><br>
<br>
<samp>Example: path /usr/bin:/bin</samp><br>
<br>
<samp>Default: /bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin:.</samp><br>
<br>
<br>

<strong>addparam</strong><br>
Start point of a {parameter entry}.<br>
<br>
<samp>Usage:<br>
addparam<br>
[<br>
...<br>
options for a parameter entry here<br>
...<br>
]<br></samp><br>
<br>

<p> <h3>Parameter entries</h3>
A parameter entry is a part where info can be specified for a single parameter for the current install command. A parameter entry starts with 'addparam' and a left square bracket('[') beaneath it. The parameter entry ends with a right square bracket(']'). All the configuration options for a parameter entry should be between the 2 square brackets.<br>
Parameter entries can only be defined inside a {commandentry}<br>
<br>

Here is a small example how a parameter entry may look like:<br>

<pre><samp>addparam
[
   name Enable Debug
   description Enable debugging code and symbols
   parameter --enable-debug
   defaultval false
   type bool
]
<br></samp></pre>
<br>
A parameter entry has the following configure options: <br>
<br>

<strong>name</strong><br>
Specifies a name for this parameter. This name is used for the installer itself(not for the actual command).<br>
<br>
<samp>Usage: name namehere</samp><br>
<br>
<samp>Example: name prefix</samp><br>
<br>
<br>

<strong>parameter</strong><br>
The parameter's name. This is used when exucuting the install command. (UNDONE)<br>
<br>
<samp>Usage: parameter paramnamehere</samp><br>
<br>
<samp>Example: parameter --prefix=%s</samp><br>
<br>
<br>

<strong>description</strong><br>
You can specify a description for this parameter here. You can also add a translation to the {lang file}.<br>
<br>
<samp>description descriptionoftheparamhere</samp><br>
<br>
<samp>Example: description This will set the installation prefix for package test.</samp><br>
<br>
<br>

<strong>type</strong><br>
Specifies how this parameter can be changed.<br>
<br>
<samp>Usage: type string|dir|list|bool</samp><br>
string: the user can specify a line of text to define a value for this parameter.<br>
dir: the user can select a directory to define a value for this parameter.<br>
list: the user can choose from a list of choices. The choices are defined by the 'addchoice' option (see below).<br>
bool: the user can specify if this parameter is used at all.<br>
<br>
<samp>Example: type list</samp><br>
<br>
<samp>Default: bool</samp><br>
<br>
<br>

<strong>defaultval</strong><br>
Specifies the default value used for this parameter. See the {type section} for valid values.<br>
<br>
<samp>Usage: defaultval defaultvaluehere</samp><br>
<br>
<samp>Example: defaultval Yellow</samp><br>
<br>
<br>

<strong>varname</strong><br>
Gives this parameter a variabele name. You should use this if a command which may need root access depends on the value of this parameter. See the {basics section} and the 'needroot' option in the commandentry section for more info.<br>
<br>
<samp>Usage: varname somenamehere</samp><br>
<br>
<samp>Example:<br>
<pre>
...
commandentry
[
   command ./configure
   ...
   addparam
   [
      name Install prefix
      ...
      varname prefix
   ]
]

commandentry
[
   command make install
   needroot dependson prefix
]
</pre>
</samp><br>
<br>

<strong>addchoice</strong><br>
You can use this if the parameter uses 'list' to define a value. Choices can be added to a {language file} for translation.<br>
<br>
<samp>Usage: addchoice choicenamehere</samp><br>
<br>
<samp>Example: addchoice Yellow</samp><br>
<br>
<br>


<p> <h2><A href="#toc-create" name="create">Creating an install package</A></h2>
In the previous sections there is explained what the basics are, which config options there are etc. In this section there will be explained how to apply those.<br>
All the files(except the language files) which tell what the installer should do and how to package must be created go in a single directory. After this directory contains everything necessarily you can run a script with this directory as first argument to create the installer. <br>
<br>
<p> <h3>Directory layout</h3>
Here is a table for how the directory layout should look like:<br>
<br>
<table border="1">
  <caption>Directory layout</caption>
  <tbody>
    <tr>
      <th>File/directory</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>install.cfg</td>
      <td>The main configuration file.</td>
    </tr>
    <tr>
      <td>welcome</td>
      <td>A plain text file containing the welcome message.</td>
    </tr>
    <tr>
      <td>license</td>
      <td>A plain text file containing a license agreement.</td>
    </tr>
    <tr>
      <td>finish</td>
      <td>A plain text file containing text which will be displayed when the installation is finished.</td>
    </tr>
    <tr>
      <td>intro picture</td>
      <td>An image which will be displayed at the welcome screen. The name of the file has to be specified in the config file.</td>
    </tr>
    <tr>
    <tr>
      <td>files_all/</td>
      <td>Directory containing all the files that must be installed. These are used for every operating system.</td>
    </tr>
    <tr>
      <td>files_[osname]/</td>
      <td>Directory containing files which are only meant for the operating system specified by [osname]. [osname] should be replaced by a valid operating system. A valid osname is the output in lowercase from the shell command 'uname'. Some examples are: linux, netbsd, freebsd.</td>
    </tr>
  </tbody>
</table>
<br>
<br>

The config file ('install.cfg') should always be present. There should also be atleast one 'files_all' or 'files_[osname]' directory.<br>

<br>
<strong>Example</strong><br>
<ul>
   <li> release/ (toplevel directory)
   <ul>
      <li> install.cfg </li>
      <li> welcome </li>
      <li> files_all/
      <ul>
         <li> config1.cfg </li>
         <li> readme.txt </li>
         <li> notes.txt </li>
      </ul>
      </li>
      <li> files_linux/
      <ul>
         <li> someexe.bin </li>
      </ul>
      </li>
      <li> files_freebsd/
      <ul>
         <li> someexe.bin </li>
      </ul>
      </li>
   </ul>
   </li>
 </ul>
<br>
<br>

You can find other, 'real' examples in the example/ directory.<br>
<br>

<p> <h3>Creating the installer</h3>
OK now you know how to make a directory layout we can start with the actual creation of the installer.<br>
<br>
In the main directory of the nixstaller package there is a script called 'geninstall.sh'. If you invoke this script it will copy all the files that need to be in the installer package(translations, frontends, the files that needs to be installed) to a temporary directory.<br>
After that it will call makeself to finish the job and you should have an installer.<br>
The script must be run from the main nixstaller directory and has as first argument the directory that you just created in the above section.<br>
<br>

<samp>Example: ./geninstall.sh release/</samp><br>
<br>

This will create an installer from the release/ directory. The installer will be simply called setup.sh (you can rename it afterwards).<br>
To test the installer simply run <samp>./setup.sh</samp> and see if it works.<br>
<br>

<p> <h2><A href="#toc-compile" name="compile">Compiling nixstaller</A></h2>
First undone line.<br>
Second undone line.<br>

<p> <h2><A href="#toc-faq" name="faq">Frequently Asked Questions (FAQ)</A></h2>
First undone line.<br>
Second undone line.<br>

</body>
</html>
